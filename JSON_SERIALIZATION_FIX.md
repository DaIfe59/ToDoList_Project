# Исправление проблем сериализации Task в JSON

## Проблемы, которые были исправлены:

### 1. Смешанные библиотеки сериализации
- **Было**: Клиент использовал `Newtonsoft.Json`, а `ApiService` использовал `System.Net.Http.Json` (System.Text.Json)
- **Стало**: Везде используется `Newtonsoft.Json` для консистентности

### 2. Несоответствие атрибутов сериализации
- **Было**: В клиентской модели `TaskItem` был атрибут `[JsonProperty("id")]` для Id, но в серверной модели его не было
- **Стало**: Добавлены атрибуты `[JsonProperty]` во все модели на клиенте и сервере

### 3. Отсутствие настройки сериализации на сервере
- **Было**: Сервер использовал стандартный System.Text.Json
- **Стало**: Настроен Newtonsoft.Json с правильными настройками

### 4. Проблемы с валидацией модели
- **Было**: Сервер ожидал поле `Category`, но получал только `CategoryId`
- **Стало**: Добавлена правильная валидация, отключена автоматическая валидация для nullable типов

### 5. Проблемы с отображением категорий
- **Было**: Категории не отображались в списке задач (все показывалось как "Без категории")
- **Стало**: Добавлена инициализация базы данных, логирование, методы отладки

## Внесенные изменения:

### Клиентская часть (TODOListClient):
1. **Models/TaskItem.cs** - добавлен атрибут `[JsonProperty("id")]` для Id, добавлена валидация
2. **Models/Category.cs** - добавлены атрибуты `[JsonProperty]` для Id и Name, добавлена валидация
3. **ApiService.cs** - заменен System.Text.Json на Newtonsoft.Json, улучшена обработка ошибок
4. **MainWindow.xaml.cs** - добавлено логирование, улучшена загрузка категорий

### Серверная часть (TODOListServer):
1. **Models/TaskItem.cs** - добавлен атрибут `[JsonProperty("id")]` для Id, добавлена валидация
2. **Models/Category.cs** - добавлены атрибуты `[JsonProperty]` для Id и Name, добавлена валидация
3. **Program.cs** - настроен Newtonsoft.Json, исправлен путь к базе данных, отключена автоматическая валидация, добавлена инициализация БД
4. **TODOListServer.csproj** - добавлен пакет `Microsoft.AspNetCore.Mvc.NewtonsoftJson`
5. **Controllers/TasksController.cs** - добавлена проверка валидации модели, исправлена обработка Category, добавлено логирование и методы отладки
6. **Controllers/CategoriesController.cs** - добавлена проверка валидации модели, добавлено логирование

## Результат:
Теперь сериализация Task в JSON работает корректно:
- Консистентное использование Newtonsoft.Json везде
- Правильные атрибуты для всех свойств
- Корректная обработка ошибок HTTP
- Правильная настройка сервера
- Исправлена валидация модели - сервер больше не ожидает поле Category
- Категории теперь правильно отображаются в списке задач
- Добавлено логирование для отладки

## Запуск:
1. Запустите сервер: `dotnet run` в папке TODOListServer
2. Запустите клиент: `dotnet run` в папке TODOListClient
3. Проверьте работу через Swagger UI по адресу http://localhost:5143

## Отладка:
Если категории все еще не отображаются:

1. **Проверьте логи сервера** - они покажут, сколько категорий и задач загружается
2. **Используйте метод отладки**: GET `/api/tasks/debug` - покажет состояние базы данных
3. **Сбросьте базу данных**: POST `/api/tasks/reset` - пересоздаст тестовые данные
4. **Проверьте консоль клиента** - там будет информация о загруженных категориях и задачах

## Тестирование:
После исправлений:
- Категории должны загружаться в комбобокс
- При добавлении задачи должна выбираться категория
- В списке задач должны отображаться названия категорий вместо "Без категории"
